<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyGym Backend Tester</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .sidebar {
            position: fixed;
            left: 0;
            top: 140px;
            width: 200px;
            background: white;
            padding: 20px;
            border-right: 2px solid #e9ecef;
            height: calc(100vh - 140px);
            overflow-y: auto;
        }
        .sidebar a {
            display: block;
            padding: 10px;
            margin-bottom: 5px;
            color: #667eea;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        .sidebar a:hover {
            background: #f8f9fa;
        }
        main {
            margin-left: 220px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Debug LocalStorage -->
        <div id="localStorageDebug" style="background:#f8f9fa;border:1px solid #e9ecef;padding:10px 20px;margin-bottom:15px;border-radius:8px;font-size:0.95em;max-width:600px;">
            <strong>Debug LocalStorage:</strong>
            <div><b>Token:</b> <span id="debugToken"></span></div>
            <div><b>UserId:</b> <span id="debugUserId"></span></div>
        </div>
            // Mostrar localStorage en pantalla (debug)
            function updateLocalStorageDebug() {
                const debugToken = document.getElementById('debugToken');
                const debugUserId = document.getElementById('debugUserId');
                if (debugToken) debugToken.textContent = localStorage.getItem('token') || '(vac√≠o)';
                if (debugUserId) debugUserId.textContent = localStorage.getItem('userId') || '(vac√≠o)';
            }
            updateLocalStorageDebug();
            window.addEventListener('storage', updateLocalStorageDebug);
            // Tambi√©n actualizar tras login/logout
            document.addEventListener('tokenChanged', updateLocalStorageDebug);
        <header>
            <h1>üèãÔ∏è MyGym Backend Tester</h1>
            <div class="config">
                <label for="baseUrl">Base URL:</label>
                <input type="text" id="baseUrl" value="https://us-central1-mygym-912d1.cloudfunctions.net" placeholder="https://tu-proyecto.cloudfunctions.net">
                <button id="logoutBtn" style="margin-left:20px;display:none;">Cerrar sesi√≥n</button>
            </div>
        </header>

        <!-- Landing Page -->
        <section class="landing">
            <h2>Bienvenido a MyGym</h2>
            <p>Gestion√° tu gimnasio, usuarios, rutinas y finanzas desde un solo lugar.</p>
            <div class="landing-actions">
                <button id="openLoginModal">Iniciar sesi√≥n</button>
                <button id="openRegisterModal">Registrarse</button>
            </div>
        </section>

        <nav class="sidebar">
            <a href="#auth">üîê Auth</a>
            <a href="#users">üë§ Usuarios</a>
            <a href="#gyms">üè¢ Gimnasios</a>
            <a href="#exercises">üí™ Ejercicios</a>
            <a href="#routines">üìã Rutinas</a>
            <a href="#progress">üìä Progreso</a>
            <a href="#streaks">üî• Rachas</a>
            <a href="#registrations">üìù Inscripciones</a>
            <a href="#payments">üí≥ Pagos</a>
            <a href="#finance">üí∞ Finanzas</a>
        </nav>

        <!-- Modales -->
        <div id="loginModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeLoginModal">&times;</span>
                <h2>Iniciar sesi√≥n</h2>
                <form id="loginForm">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Contrase√±a" required>
                    <button type="submit">Ingresar</button>
                </form>
                <div id="loginModalResponse" class="response"></div>
            </div>
        </div>
        <div id="registerModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeRegisterModal">&times;</span>
                <h2>Registrarse</h2>
                <form id="registerForm">
                    <label for="registerType" style="margin-bottom:5px;">¬øTe quer√©s registrar como:</label>
                    <select id="registerType" required style="margin-bottom:15px;">
                        <option value="client">Cliente</option>
                        <option value="gym">Gimnasio</option>
                    </select>
                    <div id="registerClientFields">
                        <input type="email" id="registerEmail" placeholder="Email" required>
                        <input type="password" id="registerPassword" placeholder="Contrase√±a" required>
                        <input type="password" id="registerPassword2" placeholder="Confirmar contrase√±a" required>
                        <input type="text" id="registerName" placeholder="Nombre completo" required>
                        <input type="text" id="registerDni" placeholder="DNI" required>
                        <input type="date" id="registerBirthDate" placeholder="Fecha de nacimiento" required>
                        <input type="text" id="registerGymId" placeholder="ID de gimnasio" required>
                        <select id="registerGender">
                            <option value="">G√©nero (opcional)</option>
                            <option value="male">Masculino</option>
                            <option value="female">Femenino</option>
                            <option value="other">Otro</option>
                        </select>
                        <input type="url" id="registerAvatarUri" placeholder="Avatar URL (opcional)">
                        <input type="text" id="registerPhone" placeholder="Tel√©fono (opcional)">
                        <input type="number" id="registerWeight" placeholder="Peso (kg, opcional)" min="20" max="500">
                        <input type="number" id="registerHeight" placeholder="Altura (cm, opcional)" min="100" max="250">
                    </div>
                    <div id="registerGymFields" style="display:none;">
                        <input type="email" id="registerGymEmail" placeholder="Email" required>
                        <input type="password" id="registerGymPassword" placeholder="Contrase√±a" required>
                        <input type="text" id="registerGymBusinessName" placeholder="Nombre del gimnasio" required>
                        <input type="text" id="registerGymAddress" placeholder="Direcci√≥n" required>
                        <input type="text" id="registerGymPhone" placeholder="Tel√©fono (opcional)">
                        <input type="url" id="registerGymAvatarUri" placeholder="Avatar URL (opcional)">
                    </div>
                    <button type="submit">Crear cuenta</button>
                </form>
                <div id="registerModalResponse" class="response"></div>
            </div>
        </div>

        <main>
            </section>

            <!-- ==================== GIMNASIOS ==================== -->
            <section class="section" id="gyms">
                <h2>üè¢ Gimnasios</h2>
                <div class="endpoint">

                <div class="endpoint">
                    <h3>Listar Gimnasios</h3>
                    <button onclick="getAllGyms()">GET /gyms/gyms</button>
                    <div class="response" id="getAllGymsResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Obtener Gimnasio</h3>
                    <input type="text" id="getGymId" placeholder="gymId">
                    <button onclick="getGym()">GET /gyms/gyms/:gymId</button>
                    <div class="response" id="getGymResponse"></div>
                </div>
            </section>

            <!-- ==================== EJERCICIOS ==================== -->
            <section class="section" id="exercises">
                <h2>üí™ Ejercicios</h2>
                <div class="endpoint">
                    <h3>Crear Ejercicio</h3>
                    <form id="createExerciseForm">
                        <input type="text" id="exerciseNombre" placeholder="Nombre" required>
                        <input type="text" id="exerciseDescripcion" placeholder="Descripci√≥n (opcional)">
                        <select id="exerciseCategoria" required>
                            <option value="">Categor√≠a</option>
                            <option value="fuerza">Fuerza</option>
                            <option value="cardio">Cardio</option>
                            <option value="flexibilidad">Flexibilidad</option>
                            <option value="otro">Otro</option>
                        </select>
                        <input type="text" id="exerciseGrupoMuscular" placeholder="Grupo muscular (opcional)">
                        <input type="text" id="exerciseEquipamiento" placeholder="Equipamiento (opcional)">
                        <input type="url" id="exerciseVideoUrl" placeholder="URL del video (opcional)">
                        <input type="url" id="exerciseImagenUrl" placeholder="URL de la imagen (opcional)">
                        <textarea id="exerciseInstrucciones" placeholder="Instrucciones (opcional)"></textarea>
                        <button type="submit">POST /exercises/create</button>
                    </form>
                    <div class="response" id="createExerciseResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Listar Ejercicios</h3>
                    <button onclick="getAllExercises()">GET /exercises</button>
                    <div class="response" id="getAllExercisesResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Obtener Ejercicio</h3>
                    <input type="text" id="getExerciseId" placeholder="exerciseId">
                    <button onclick="getExerciseById()">GET /exercises/:exerciseId</button>
                    <div class="response" id="getExerciseByIdResponse"></div>
                </div>
            </section>

            <!-- ==================== RUTINAS ==================== -->
            <section class="section" id="routines">
                <h2>üìã Rutinas</h2>
                
                <div class="endpoint">
                    <h3>Crear Rutina</h3>
                        <div class="endpoint">
                            <h3>Crear Rutina</h3>
                            <form id="createRoutineForm">
                                <input type="text" id="routineNombre" placeholder="Nombre" required>
                                <input type="text" id="routineDescripcion" placeholder="Descripci√≥n (opcional)">
                                <div id="routineExercises">
                                    <h4>Ejercicios</h4>
                                    <div class="routine-exercise">
                                        <select class="exerciseId" required>
                                            <option value="">Seleccionar ejercicio...</option>
                                        </select>
                                        <input type="number" class="sets" placeholder="Sets" min="1" required>
                                        <input type="number" class="reps" placeholder="Reps" min="1" required>
                                        <input type="number" class="weight" placeholder="Peso (opcional)">
                                        <input type="text" class="notes" placeholder="Notas (opcional)">
                                        <button type="button" class="removeExercise" onclick="this.parentElement.remove()">Quitar</button>
                                    </div>
                                </div>
                                <button type="button" id="addExerciseBtn">Agregar ejercicio</button>
                                <button type="submit">POST /routines/create</button>
                            </form>
                            <div class="response" id="createRoutineResponse"></div>
                        </div>
                    <h3>Asignar Rutina a Usuario</h3>
                    <input type="text" id="assignUserId" placeholder="userId">
                    <input type="text" id="assignRoutineId" placeholder="routineId">
                    <button onclick="assignRoutine()">POST /routines/assign</button>
                    <div class="response" id="assignRoutineResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Obtener Rutina del Usuario</h3>
                    <input type="text" id="getUserRoutineId" placeholder="userId">
                    <button onclick="getUserRoutine()">GET /routines/user/:userId</button>
                    <div class="response" id="getUserRoutineResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Obtener Rutina por ID</h3>
                    <input type="text" id="getRoutineId" placeholder="routineId">
                    <button onclick="getRoutineById()">GET /routines/:routineId</button>
                    <div class="response" id="getRoutineByIdResponse"></div>
                </div>
            </section>

            <!-- ==================== PROGRESO ==================== -->
            <section class="section" id="progress">
                                               <h2>üìä Progreso</h2> 
                                               <div class="endpoint">
                                                    <h3>Registrar Progreso</h3>
                                                    <form id="logProgressForm">
                                                        <input type="date" id="progressDate" placeholder="Fecha (opcional)">
                                                        <div id="progressExercises">
                                                            <h4>Ejercicios realizados</h4>
                                                            <div class="progress-exercise">
                                                                <select class="exerciseId" required><option value="">Seleccionar ejercicio...</option></select>
                                                                <input type="number" class="completedSets" placeholder="Sets completados" min="0" required>
                                                                <input type="number" class="completedReps" placeholder="Reps completadas (opcional)" min="0">
                                                                <input type="number" class="weight" placeholder="Peso (opcional)">
                                                                <input type="text" class="notes" placeholder="Notas (opcional)">
                                                                <button type="button" class="removeProgressExercise" onclick="this.parentElement.remove()">Quitar</button>
                                                            </div>
                                                        </div>
                                                        <button type="button" id="addProgressExerciseBtn">Agregar ejercicio</button>
                                                        <input type="text" id="progressNotes" placeholder="Notas generales (opcional)">
                                                        <button type="submit">POST /routines/progress</button>
                                                    </form>
                                                    <div class="response" id="logProgressResponse"></div>
                                                </div>
                                
            </section>

            <!-- ==================== RACHAS ==================== -->
            <section class="section" id="streaks">
                <h2>üî• Rachas</h2>
                
                <div class="endpoint">
                    <h3>Hacer Check-in</h3>
                    <input type="text" id="checkinUserId" placeholder="userId">
                    <input type="text" id="checkinClassId" placeholder="classId/routineId">
                    <button onclick="checkIn()">POST /streaks/check-in</button>
                    <div class="response" id="checkInResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Racha</h3>
                    <input type="text" id="streakUserId" placeholder="userId">
                    <button onclick="getStreak()">GET /streaks/streak/:userId</button>
                    <div class="response" id="getStreakResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Historial</h3>
                    <input type="text" id="historyUserId" placeholder="userId">
                    <button onclick="getHistory()">GET /streaks/history?userId=</button>
                    <div class="response" id="getHistoryResponse"></div>
                </div>
            </section>

            <!-- ==================== INSCRIPCIONES ==================== -->
            <section class="section" id="registrations">
                <h2>üìù Inscripciones</h2>
                
                <div class="endpoint">
                    <h3>Crear Inscripci√≥n</h3>
                    <form id="createRegistrationForm">
                        <input type="text" id="registrationUserId" placeholder="ID de usuario" required>
                        <input type="text" id="registrationGymId" placeholder="ID de gimnasio" required>
                        <select id="registrationMembershipType" required>
                            <option value="">Tipo de membres√≠a</option>
                            <option value="monthly">Mensual</option>
                            <option value="annual">Anual</option>
                            <option value="weekly">Semanal</option>
                        </select>
                        <input type="date" id="registrationStartDate" placeholder="Fecha de inicio" required>
                        <button type="submit">POST /registrations</button>
                    </form>
                    <div class="response" id="createRegistrationResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Mis Inscripciones</h3>
                    <input type="text" id="getRegistrationsUserId" placeholder="userId">
                    <button onclick="getUserRegistrations()">GET /registrations?userId=</button>
                    <div class="response" id="getUserRegistrationsResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Historial de Inscripciones</h3>
                    <input type="text" id="getRegistrationHistoryUserId" placeholder="userId">
                    <button onclick="getRegistrationHistory()">GET /registrations/history?userId=</button>
                    <div class="response" id="getRegistrationHistoryResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Cancelar Inscripci√≥n</h3>
                    <input type="text" id="cancelRegistrationId" placeholder="registrationId">
                    <button onclick="cancelRegistration()">POST /registrations/:id/cancel</button>
                    <div class="response" id="cancelRegistrationResponse"></div>
                </div>
            </section>

            <!-- ==================== PAGOS ==================== -->
            <section class="section" id="payments">
                <h2>üí≥ Pagos</h2>
                
                <div class="endpoint">
                    <h3>Procesar Pago</h3>
                    <form id="processPaymentForm">
                        <input type="text" id="paymentUserId" placeholder="ID de usuario" required>
                        <input type="number" id="paymentAmount" placeholder="Monto" min="1" required>
                        <select id="paymentMethod" required>
                            <option value="">M√©todo de pago</option>
                            <option value="mercadopago">MercadoPago</option>
                            <option value="efectivo">Efectivo</option>
                            <option value="tarjeta">Tarjeta</option>
                        </select>
                        <input type="text" id="paymentDescription" placeholder="Descripci√≥n" required>
                        <button type="submit">POST /payments/process</button>
                    </form>
                    <div class="response" id="processPaymentResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Estado de Pago del Usuario</h3>
                    <input type="text" id="paymentStatusUserId" placeholder="userId">
                    <button onclick="getPaymentStatus()">GET /payments/status/:userId</button>
                    <div class="response" id="getPaymentStatusResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Historial de Pagos</h3>
                    <input type="text" id="paymentHistoryUserId" placeholder="userId">
                    <button onclick="getPaymentHistory()">GET /payments/history/:userId</button>
                    <div class="response" id="getPaymentHistoryResponse"></div>
                </div>
            </section>

            <!-- ==================== FINANZAS ==================== -->
            <section class="section" id="finance">
                <h2>üí∞ Finanzas</h2>
                
                <div class="endpoint">
                                        <form id="createRoutineForm">
                                                <input type="text" id="routineNombre" placeholder="Nombre" required>
                                                <input type="text" id="routineDescripcion" placeholder="Descripci√≥n (opcional)">
                                                <div id="routineExercises">
                                                        <h4>Ejercicios</h4>
                                                        <div class="routine-exercise">
                                                                <input type="text" class="exerciseId" placeholder="ID de ejercicio" required>
                                                                <input type="number" class="sets" placeholder="Sets" min="1" required>
                                                                <input type="number" class="reps" placeholder="Reps" min="1" required>
                                                                <input type="number" class="weight" placeholder="Peso (opcional)">
                                                                <input type="text" class="notes" placeholder="Notas (opcional)">
                                                                <button type="button" class="removeExercise" onclick="this.parentElement.remove()">Quitar</button>
                                                        </div>
                                                </div>
                                                <button type="button" id="addExerciseBtn">Agregar ejercicio</button>
                                                <button type="submit">POST /routines/create</button>
                                        </form>
                    <div class="response" id="updateFinanceSettingsResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Dashboard Financiero</h3>
                    <button onclick="getFinanceDashboard()">GET /finance/dashboard</button>
                    <div class="response" id="getFinanceDashboardResponse"></div>
                </div>

                <div class="endpoint">
                    <h3>Ver Deudores</h3>
                    <button onclick="getDebtors()">GET /finance/debtors</button>
                    <div class="response" id="getDebtorsResponse"></div>
                </div>
            </section>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>
